<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bassel Saleh">
<meta name="dcterms.date" content="2023-02-09">
<meta name="description" content="“Do you ever have déjà vu, Mrs.&nbsp;Lancaster?”">

<title>climbing the giant - The Physics of Time Loops</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/climber.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">climbing the giant</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/basselsaleh"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/bassel-saleh-5a653bb6/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mrbassoule"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Physics of Time Loops</h1>
                  <div>
        <div class="description">
          “Do you ever have déjà vu, Mrs.&nbsp;Lancaster?”
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Explainer</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Bassel Saleh </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 9, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="this-feels-familiar" class="level2">
<h2 class="anchored" data-anchor-id="this-feels-familiar">This Feels Familiar</h2>
<p>“What was that noise?” I asked myself as I spun wildly around looking for the source of the loud bang. I had just spend the past half hour or so travelling around the solar system in awe, carefully twisting and turning my spaceship to land on exotic planets and bouncing gleefully around them in my jet-powered spacesuit looking for clues. It wasn’t long before I located the source of the bang, a massive explosion glowing bright blue, expanding out from where the sun had been moments before. When the powerful blast washed over me and obscured my vision, I thought perhaps it was all over, but moments later I awoke with a sharp breath, staring up at the night sky from the safety of my cozy home planet Timber Hearth. I was standing in exactly the same place I had been at the start of my adventure, the sun still intact and everything else exactly where it had been.</p>
<p>This was the delightful experience of playing the video game <a href="https://www.mobiusdigitalgames.com/outer-wilds.html"><em>Outer Wilds</em></a> for the first time. After going through the loop several times, I found myself starting each one with a greater sense of urgency, trying my hardest to get to the next location and uncover the next clue before the inevitable supernova would send me back to the start. I became much more efficient at flying my spaceship and hurtling past early obstacles on my path to uncover the secrets of the universe. You see, time loops can be a powerful device for storytelling. For video games in particular, putting the player in the shoes of someone repeating the same experiences over and over again, with the mission to try <em>something</em> new to change the loop, creates frustration and exhiliration. It encourages the player to engage with themes like free will and the futility of trying to problem solve when control is repeatedly taken away from you.</p>
<p>Between games like <a href="https://bethesda.net/en/game/deathloop"><em>Deathloop</em></a>, <a href="https://housemarque.com/games/returnal"><em>Returnal</em></a>, and <a href="https://twelveminutesgame.com/"><em>12 Minutes</em></a>, time loops appear to be a popular mechanic in video games recently. Of course, the concept of a time loop is significantly older and more medium-cutting than the current video game boom, from classic films like <a href="https://www.imdb.com/title/tt0107048/"><em>Groundhog Day</em></a> and <a href="https://www.imdb.com/title/tt1631867/"><em>Edge of Tomorrow</em></a> to the 1915 Russian novel <a href="https://en.wikipedia.org/wiki/Strange_Life_of_Ivan_Osokin"><em>Strange Life of Ivan Osokin</em></a>. My experience with <em>Outer Wilds</em> in particular got me thinking about what the rules are in this universe that would allow such a story to be logically consistent. And how different do these rules need to be from the laws of physics governing <em>our</em> universe, the real one that we all live in. Do the laws of physics allow for time loops to plausibly exist? If not, in what ways would the laws need to be modified to permit them? Is there a way of formulating physical laws, even in principle, that <em>could</em> permit time loops without disintegrating into a pile of paradoxes and contradictions?</p>
<p>Of course, if you want to be a bit glib, you could argue that this whole avenue of thinking is silly. These are fictional stories after all, so who cares about the minutia of physics in analyzing them. The thing is, I kind of agree. Science fiction stories can be wonderful and enjoyable even when their physical worlds bear no resemblance to the one we live in. But I happen to also believe that the interplay between true science and science fiction is both fascinating and useful, for finding new interesting stories to tell as well as finding new scientific avenues to pursue. So for now we will proceed under the assumption that asking such questions might lead us to interesting places, and let our imaginations do the rest.</p>
</section>
<section id="the-red-herring-of-closed-timelike-curves" class="level2">
<h2 class="anchored" data-anchor-id="the-red-herring-of-closed-timelike-curves">The Red Herring of Closed Timelike Curves</h2>
<p>I looked up “the physics of time loops” and found lots of popular science articles on the subject, including <a href="https://next.voxcreative.com/ad/22676555/time-loop-science-deathloop-video-game">one that interviewed one of the game designers of <em>Deathloop</em></a>. While several of these articles were quite engaging to read, I was a bit disappointed to find little more than a cursory reference to some physics here and there, rather than a detailed discussion of how these physical theories would best explain time loops. Many articles jumped right to talking about <em>closed timelike curves</em> (CTCs), which are a mathematical feature of some very specific solutions to Einstein’s equations for <a href="https://en.wikipedia.org/wiki/Introduction_to_general_relativity#:~:text=General%20relativity%20is%20a%20theory,from%20their%20warping%20of%20spacetime.">general relativity</a>. In the somewhat broader discussion of more general time travel in science fiction, CTCs come up a lot, as they allow for a relatively straightforward way to allow one to travel to the past. More precisely, a CTC is a path in curved spacetime, such that if you hopped in a spaceship and travelled along it, you would end up back when you started. This isn’t through some magical teleportation or traversal backward in time, it’s simply a quirky consequence of extremely curved spacetimes, some of which are technically allowed in general relativity.</p>
<p>There are issues with taking CTCs too seriously, and some of my thoughts on this were informed by <a href="https://www.preposterousuniverse.com/podcast/2020/11/23/124-solo-how-time-travel-could-and-should-work/">Sean Carroll’s excellent podcast episode about time travel</a>, where he investigates in detail what some of these issues are. But for time loops specifically, pointing the discussion toward CTCs is misleading for many reasons. Most blatantly, CTCs exist mathematically as part of what Carroll calls a “single consistent universe”. If you were to use a CTC to travel backward in time, you would not find that events are any different than the last time you went through them. There are not alternate versions of events that you’re free to pick between each time you experience the loop, there is just <em>the</em> one universe, one sequence of concrete events, that you happen to traverse over and over again. This is just completely at odds with the kind of time travel that exists in time loop stories. In the latter, it seems more like time is something that can be unwound, events “undoing” themselves or otherwise resetting, such that choices you make this time induce slightly different initial conditions that can propagate into wildly different outcomes. For this to work, the player/protagonist must exist <em>outside</em> of the time-unwinding mechanism, or else all their memories would also be unwound and the decisions they make would be exactly the same.</p>
<p>Other small issues with the CTC picture exist as it relates to time loops. For one thing, if a time loop is to be the result of traversing a CTC, it doesn’t seem logically possible for it to depend in some way on the experience of the character. It’s a lot easier to make sense of a loop if it exists for a fixed period of time. Some time loops seem to be of variable length, such as in <em>Groundhog Day</em> and <em>Palm Springs</em>, where characters only reset the loop when they fall asleep or die. Many video game loops are similar, where some unpredictable event (like death) can trigger the loop. <em>Outer Wilds</em>, even though it has this death = loop property, actually does pretty well at avoiding the issue, since the sun goes supernova after some fixed, constant amount of time no matter what. With this property, the loop seems less attached to the conscious experience of the protagonist. You could imagine for example that if the protagonist dies, the rest of the universe chugs along until the sun explodes once more, and only then does the protagonist get sent back to the start of the loop and regain consciousness.</p>
<p>There’s also a pretty solid consensus that CTCs, despite being theoretically allowed by the equations of general relativity, are practically impossible to ever create in the universe, either because of the need for negative mass, or infinite mass, or other exotic features like cosmic strings and wormholes. But we don’t even need to defer to these issues to dismiss CTCs as being relevant for time loop stories. They just don’t produce the desired narrative effect.</p>
</section>
<section id="winding-back-the-clock" class="level2">
<h2 class="anchored" data-anchor-id="winding-back-the-clock">Winding Back the Clock</h2>
<p>So if the CTCs of general relativity can’t explain time loops, is there anything in physics that can? I mentioned the time unwinding idea, but that is sort of vague and magical. Real macroscopic events in the universe are <em>not</em> time reversible, due to the second law of thermodynamics. Ok so fine, as writers trying to craft an interesting narrative, what ideas can we lean on to at least be consistent? In principle, due to the time reversal symmetry of the <em>fundamental</em> laws of physics, if we had some way of going through every particle in the universe and pointing their momenta in the exact opposite direction, we could press play again and watch everything perfectly undo itself, throwing a big middle finger to the second law as we do so. Then of course once a desired state is reached (the start of the loop), we would need to pause and go flip all the momenta again so that events could go forward from there. Unfortunately, we have to somehow exempt the particles that make up the protagonist from this process, at least from their potential death on backward. I suppose we also need to knock them unconscious while all the unwinding is happening, or else they would witness and have memories of everything else going on. So ok fine, at some specified event (the sun exploding, for example), we grab the protagonist, knock them out, isolate them completely from everything else in the universe, go through and flip all the particle momenta so that the past 22 minutes or whatever perfectly unwinds, go through and flip all the momenta again once we hit the start of the loop, then throw the protagonist back into the universe to wake up and wonder how the hell they’re reliving the same day.</p>
<p>This seems… at least plausible (in a classical universe anyway), but I can’t stress enough just how <em>immense</em> a power would be needed to do this. Maybe we don’t have to go mess with the <em>entire</em> universe, if the solar system is isolated enough and the time interval we’re reversing is short enough, but still. This takes a nearly <a href="https://en.wikipedia.org/wiki/Laplace%27s_demon">Laplace’s demon</a> level of knowledge and computing power, not to mention the unfortunate reality that all of the momentum flipping has to happen <em>at exactly the same time</em>, which is troubling because the concept of simultaneity is its own can of worms. Still, even if it’s practically speaking <em>stupendously</em> difficult, this is at least a logically consistent mechanism for the time loop to happen, especially since the intelligence playing Laplace’s demon in this example could just take the protagonist to some other solar system while all the resetting happens and then bring them back.</p>
<p>The above scenario gets messier when you acknowledge that the universe isn’t actually classical, it’s quantum mechanical. It is not possible to go flip the momenta of all of the particles, because they do not have well-defined momenta at all. Furthermore, in the standard model of particle physics the fundamental laws don’t actually have nice, clean time reversal symmetry. They have what is called <a href="https://en.wikipedia.org/wiki/CPT_symmetry">CPT invariance</a>, where the laws only function normally if you reverse time <em>and</em> flip the charge of all particles <em>and</em> flip the polarity of all particles (swap right and left handedness, so to speak) at the same time. But ok <em>fine</em>, you do all that… somehow. The problem is that in quantum mechanics, the observable thermodynamic evolution of the universe is not deterministic, at least not to any one observer. Quantum outcomes will occasionally be random, such that if you hit restart on the universe and watched it unfold from the exact same initial condition as before, you wouldn’t necessarily observe the exact same unfolding of events. So either you need to force the quantum measurements to somehow reproduce the same results they had last time (nothing in our understanding of quantum mechanics suggests this is even remotely possible), or you need to prepare yourself to make the final plunge: into the universe of many worlds.</p>
</section>
<section id="you-get-a-world-and-you-get-a-world" class="level2">
<h2 class="anchored" data-anchor-id="you-get-a-world-and-you-get-a-world">You Get a World, and You Get a World</h2>
<p>If you aren’t aware, it turns out there isn’t just one theory of quantum mechanics, there are several different competing formulations. These different theories are ontologically distinct, saying different things about what the universe fundamentally is like, but they all agree with each other when predicting the outcomes of experiments. For this reason, some modern physicists disagree that they truly constitute different scientific theories, and there’s a whole <a href="https://en.wikipedia.org/wiki/Interpretations_of_quantum_mechanics">philosophical debate on this subject</a>, if you’re curious. For our purposes we’re going to adopt the so-called <a href="https://en.wikipedia.org/wiki/Many-worlds_interpretation">many-worlds formulation of quantum mechanics</a>, since this is the physical theory which unlocks the pantheon of parallel universes that might save us in our pursuit of time loop physics.</p>
<p>In simple terms, many-worlds posits that there is only one thing that is real, the quantum mechanical wavefunction of the universe, and this wavefunction evolves according to the Schrödinger equation. Quantum mechanical orthodoxy demands that this wavefunction collapse to one discrete outcome when a measurement is made, but in many-worlds, we do away with the concept of collapse and replace it with the concept of <em>branching</em>. Whenever a quantum measurement occurs that could have gone one way or another, the universe splits into two, or three, or maybe infinite copies of itself, where each copy proceeds with one of the outcomes.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> These parallel copies are branches of the wavefunction, and believing in them allows one to keep an internally consistent picture of the world.</p>
<p>This is all perfectly kosher, in the sense that many-worlds (or Everettian) quantum mechanics is a genuine, bonafied physical theory, with equations and everything, one that is consistent with the universe we actually live in. However, before you get excited about jumping around to alternate timelines to meet different versions of yourself, it’s worth knowing what <em>is</em> and <em>is not</em> possible in this theory. For one thing, many-worlds says that once a branching of the wavefunction happens, <em>that’s it</em>. The branches no longer interact or have any causal influence over each other, and there is no way to travel from one to the other.</p>
<p><em>But ok fine</em>, if we <em>really</em> want to make time loops happen (and we do, if we are writers trying to tell a story), let’s say we can invent some mechanism that lets a person (or spaceship) jump between branches of the wavefunction. Ignoring for the moment any wild paradoxes that might create, can we at least <em>imagine</em> that such a thing were possible? If we let ourselves do this, what would such a person’s experience be like? Would it feel the way it felt to Bill Murray in <em>Groundhog Day</em> or to the spacefaring protagonist of <em>Outer Wilds</em>?</p>
</section>
<section id="winding-back-the-quantum-clock" class="level2">
<h2 class="anchored" data-anchor-id="winding-back-the-quantum-clock">Winding Back the… Quantum Clock?</h2>
<p>Well, not quite. There is one more sticking point, which is that if we’re jumping between branches, that doesn’t let us choose what moment of time we’d like to jump to. Really what we need is to travel <em>backwards</em> to a point before the branching. So it turns out we actually need to refer back to our old thermodynamic argument for unwinding events, but this time instead of flipping momenta to reverse time like Laplace’s demon, we need our grand intelligence (perhaps called Everett’s demon) to unwind the quantum mechanical wavefunction of the universe, which is to say unwind <em>all of the branches together</em>, using CPT invariance to ensure it all stays consistent. This effectively undoes the series of quantum entanglements that caused the wavefunction to branch, bringing us back to a point where we can pause, take a breath, and apply the CPT transformation once more to point us back in the right direction. In a very real sense, this is <em>exponentially harder</em> than the already insane task of reversing particle momenta in the classical universe, and unlike when we could imagine dragging our unconscious protagonist to a nearby solar system, now we need our protagonist to somehow sit <em>outside</em> of the wavefunction of the universe? That doesn’t seem plausible at all. But in my opinion it’s at least better than pretending quantum mechanics doesn’t exist, so it’s about as good as we’re going to get. So with all that said… <em>now</em> can we answer whether this wacky universe would behave like <em>Groundhog Day</em>, <em>Outer Wilds</em>, <em>Deathloop</em>, etc.?</p>
<p>In principle, yes… I think. This is where not being an expert starts to hinder us, because the details of how such a bizarre thing might work are murky and unreliable. At some point, you have to start putting pen to paper and ask yourself what the equations tell you. Scientific theories are not just collections of ideas, they have well-posed mathematical structure, and we better be careful about messing with that structure lest we accidentally break everything else about the universe. But in my humble opinion, considering the discussion we’ve had so far, this is the version of time looping physics that makes the most sense to me, or at least creates the least amount of trouble. You have to do a lot of hand waving about how one might travel outside of their own branch, and you might have to do some careful tweaking to make sure you don’t end up somehow inside of yourself or otherwise conflicting with matter on another branch, but if we suspend a little bit of disbelief, then this is the physical theory that has the most explanatory power for justifying a genuine time loop. It’s the only one that lets us make sense of the fact that each loop feels different, with different actions leading to different outcomes. From a story perspective, this ingredient is essential, and you could never get it with closed timelike curves alone.</p>
<p>Sean Carroll claims that the “right” way to do time travel in science fiction is with the single, consistent universe idea. Which is to say, no matter what kind of time-faring shenanigans you get up to, whether it’s CTCs or something else, you’ll never exert causal influence in a way that makes things happen any differently than they already happened. This is in some sense the most physics-pleasing way of doing time travel, but unfortunately, with time loop stories this explanation was dead from the word go. That is what sent me on this rabbit hole of trying to find the next best explanation. But please, if you have some idea that you think works even better, or if you find a flaw in the arguments I’ve given here, let me know! I can always be reached on Twitter <a href="https://twitter.com/mrbassoule"><span class="citation" data-cites="mrbassoule">@mrbassoule</span></a>.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Technically, this branching doesn’t occur for <em>every</em> possible quantum measurement. The precise mechanism for wavefunction branching is a bit more subtle and involves something called quantum decoherence, but a more detailed discussion is outside the scope of this article.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>